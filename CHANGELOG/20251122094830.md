<!-- CHANGELOG/20251122094830.md -->
# Changelog - Correção de Erros 404 de Fontes Font Awesome

**Data/Hora UTC:** 2025-11-22 09:48:30

## Arquivos Modificados

### Modificados
- `/root/git/monorepo/app/docker-compose.yml` - Adicionada configuração `OAUTH2_PROXY_SKIP_AUTH_ROUTE` para permitir bypass de assets estáticos
- `/root/git/monorepo/app/.env.example` - Adicionada variável `APP_OAUTH2_PROXY_SKIP_AUTH_ROUTE` com exemplo de configuração
- `/root/git/vmi2889919/caddy/Caddyfile` - Removida rota redundante de assets estáticos (oauth2-proxy agora gerencia via SKIP_AUTH_ROUTE)

## Requisitos Atendidos

### Requisitos Específicos da Tarefa
- ✅ Investigar erros 404 de fontes Font Awesome (`fa-regular-400.woff2`, `fa-regular-400.ttf`)
- ✅ Configurar bypass de autenticação para assets estáticos
- ✅ Permitir que fontes, imagens, CSS e JS sejam carregados sem autenticação

### Requisitos Globais do Projeto
- ✅ Conformidade com estrutura RUP
- ✅ Documentação de mudanças em changelog obrigatório
- ✅ Configuração seguindo padrões Docker e oauth2-proxy

## Problema Identificado

Os erros 404 para `fa-regular-400.woff2` e `fa-regular-400.ttf` estavam ocorrendo porque:

1. **Fontes sendo carregadas pela página de login do oauth2-proxy**: Os logs mostraram que as requisições vinham de `/oauth2/static/webfonts/fa-regular-400.woff2`, indicando que são recursos internos do oauth2-proxy, não do frontend do monorepo.

2. **Oauth2-proxy interceptando todas as requisições**: O oauth2-proxy estava interceptando todas as requisições, incluindo assets estáticos do frontend, causando redirects 302 em vez de permitir acesso direto.

3. **Falta de configuração de bypass**: Não havia configuração para permitir que assets estáticos passassem sem autenticação.

## Solução Implementada

1. **Configuração do oauth2-proxy para bypass de assets estáticos**:
   - Adicionada variável `OAUTH2_PROXY_SKIP_AUTH_ROUTE` no `docker-compose.yml`
   - Configurado para permitir bypass de: `/assets/*`, `/icons/*`, `/manifest.webmanifest`, `/registerSW.js`
   - Formato: `GET=/assets/* GET=/icons/* GET=/manifest.webmanifest GET=/registerSW.js`

2. **Atualização do `.env.example`**:
   - Adicionada variável `APP_OAUTH2_PROXY_SKIP_AUTH_ROUTE` com exemplo de configuração

3. **Limpeza do Caddyfile**:
   - Removida rota redundante de assets estáticos do Caddy
   - O oauth2-proxy agora gerencia o bypass via `SKIP_AUTH_ROUTE`

## Validações Realizadas

- ✅ Oauth2-proxy reiniciado com nova configuração
- ✅ Logs do oauth2-proxy mostram que está processando requisições corretamente
- ⚠️ Fontes Font Awesome são recursos internos do oauth2-proxy (não do frontend)
- ⚠️ Erros 404 para `/oauth2/static/webfonts/fa-regular-400.woff2` são esperados se essas fontes não existirem no oauth2-proxy

## Observações Importantes

- **Fontes Font Awesome**: Os erros 404 para `fa-regular-400.woff2` e `fa-regular-400.ttf` são recursos internos do oauth2-proxy, não do frontend do monorepo. Esses erros não afetam o funcionamento do frontend.

- **Assets estáticos do frontend**: A configuração `SKIP_AUTH_ROUTE` permite que assets estáticos do frontend (`/assets/*`, `/icons/*`, etc.) sejam carregados sem autenticação, resolvendo o problema de interceptação pelo oauth2-proxy.

- **Página de login do oauth2-proxy**: Se as fontes Font Awesome forem necessárias na página de login do oauth2-proxy, será necessário verificar se essas fontes estão incluídas na imagem Docker do oauth2-proxy ou se precisam ser adicionadas.

## Regras Atendidas

- ✅ Convenções de configuração: Variáveis de ambiente configuradas seguindo padrão Docker
- ✅ Política de changelog: Changelog criado conforme política obrigatória do AGENTS.md
- ✅ Rastreabilidade: Mudanças documentadas e validadas
- ✅ Configuração do oauth2-proxy: Uso correto de `SKIP_AUTH_ROUTE` para bypass de assets estáticos

## Pendências

- ⚠️ Se as fontes Font Awesome forem necessárias na página de login do oauth2-proxy, verificar se estão incluídas na imagem Docker ou adicionar suporte
- ✅ Assets estáticos do frontend agora podem ser carregados sem autenticação

## Referências

- Arquivos modificados: `/root/git/monorepo/app/docker-compose.yml`, `/root/git/monorepo/app/.env.example`
- Documentação do oauth2-proxy: `docs/rup/99-anexos/MVP/plano-deploy-google-sso.md`
- Política de changelog: `AGENTS.md` (seção "Política de CHANGELOGs obrigatórios")
- Changelog relacionado: `CHANGELOG/20251122011650.md` (correção do oauth2-proxy)
