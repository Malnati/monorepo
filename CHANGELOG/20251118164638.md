<!-- CHANGELOG/20251118164638.md -->
# Changelog - Correção do Prettier e Execução Local via Docker

**Data/Hora UTC:** 2025-11-18 16:46:38

## Arquivos Modificados

### Criados
- `.prettierignore` - Arquivo de configuração do Prettier na raiz do projeto

### Modificados
- `.github/workflows/prettier.yml` - Atualizado para usar `.prettierignore` da raiz em vez de `.github/workflows/.prettierignore` e removida permissão inválida `workflows: read`
- `scripts/format-prettier.sh` - Melhorado para suportar execução via Docker e detectar `.prettierignore` na raiz
- `Makefile` - Atualizado target `format-prettier` para priorizar execução via Docker

## Requisitos Atendidos

### Requisitos Específicos da Tarefa
- ✅ Executar workflow do Prettier localmente usando Docker
- ✅ Corrigir problema do Prettier não ignorar arquivos/diretórios corretamente no GitHub Actions
- ✅ Garantir que a solução local replique o comportamento do workflow do GitHub

### Requisitos Globais do Projeto
- ✅ Conformidade com estrutura RUP (`docs/rup/`)
- ✅ Documentação de mudanças em changelog obrigatório
- ✅ Scripts devem seguir convenções do projeto (bash, Docker)

## Problema Resolvido

O Prettier estava falhando no GitHub Actions porque não estava respeitando corretamente o arquivo `.prettierignore` localizado em `.github/workflows/.prettierignore`. O problema ocorria porque:

1. O workflow usava `--ignore-path .github/workflows/.prettierignore`, mas quando o Prettier é executado com diretórios específicos, o caminho relativo pode não ser resolvido corretamente
2. O Prettier procura por `.prettierignore` na raiz do projeto por padrão, e usar um caminho customizado pode causar problemas de resolução

## Solução Implementada

1. **Criação de `.prettierignore` na raiz**: Criado arquivo `.prettierignore` na raiz do projeto com o mesmo conteúdo de `.github/workflows/.prettierignore`, garantindo que o Prettier encontre o arquivo de ignore automaticamente

2. **Atualização do workflow**: 
   - Modificado `.github/workflows/prettier.yml` para usar `--ignore-path .prettierignore` (raiz) em vez de `.github/workflows/.prettierignore`
   - Removida permissão inválida `workflows: read` que causava erro de sintaxe YAML no GitHub Actions

3. **Melhoria do script local**: 
   - Adicionado suporte para execução via Docker
   - Melhorada detecção de `.prettierignore` (prioriza raiz, fallback para `.github/workflows/`)
   - Adicionada detecção de ambiente Docker via variável `IN_DOCKER`
   - Melhorado tratamento de erros e mensagens informativas

4. **Atualização do Makefile**: 
   - Priorizada execução via Docker usando imagem `node:20-alpine`
   - Mantido fallback para `act` (se disponível) e script shell local
   - Garantida compatibilidade com execução local e containerizada

## Validações Realizadas

- ✅ Teste de execução via Docker: Prettier executa corretamente e encontra projetos Node.js
- ✅ Teste de ignore: Arquivos listados em `.prettierignore` (como `package.json`) são corretamente ignorados
- ✅ Teste de detecção: Script detecta corretamente `.prettierignore` na raiz
- ✅ Teste de diretórios: Script encontra corretamente projetos em `app/api/`, `app/job/`, `app/ui/`

## Regras Atendidas

- ✅ Convenções de configuração: Scripts seguem padrão Docker e Makefile do projeto
- ✅ Política de scripts: Script shell mantido apenas para entrypoint Docker (conforme `AGENTS.md`)
- ✅ Documentação: Changelog criado conforme política obrigatória
- ✅ Rastreabilidade: Mudanças documentadas e testadas

## Pendências

Nenhuma pendência identificada. A solução está pronta para uso e deve resolver o problema do Prettier no GitHub Actions.

## Referências

- Workflow original: `.github/workflows/prettier.yml`
- Script de formatação: `scripts/format-prettier.sh`
- Documentação RUP: `docs/rup/03-implementacao/padroes-de-codigo.md`
- Política de changelog: `AGENTS.md` (seção "Política de CHANGELOGs obrigatórios")
