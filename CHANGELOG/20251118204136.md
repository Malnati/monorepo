<!-- CHANGELOG/20251118204136.md -->
# 2025-11-18T20:41:36Z — Git Hook Pre-Push com Prettier via Docker

## Resumo
- Implementado git hook pre-push que executa Prettier via Docker antes de cada push
- Criado serviço Docker dedicado para Prettier no docker-compose.yml
- Adicionado script de instalação de hooks (`scripts/install-git-hooks.sh`)
- Atualizado Makefile com target `install-hooks` e melhoria no `format-prettier`
- Hook bloqueia push quando arquivos são formatados, instruindo desenvolvedor a fazer commit

## Arquivos criados
- `prettier/Dockerfile` - Imagem Docker com Prettier instalado globalmente
- `prettier/entrypoint.sh` - Script de entrada para o container Prettier
- `scripts/install-git-hooks.sh` - Script para instalar git hook pre-push
- `install-hooks.sh` - Wrapper script na raiz para facilitar execução sem make
- `CHANGELOG/20251118204136.md` - Este changelog

## Arquivos modificados
- `app/docker-compose.yml` - Adicionado serviço `prettier` com profile `tools`
- `Makefile` - Adicionado target `install-hooks` e melhorado `format-prettier` para usar docker-compose quando disponível

## Requisitos atendidos
- Git hook pre-push executa Prettier antes de cada push
- Prettier executado via Docker (sem necessidade de instalação local)
- Mesmas opções e configurações do workflow remoto aplicadas
- Hook verifica mudanças após formatação e bloqueia push se necessário
- Script de instalação é idempotente (pode ser executado múltiplas vezes)
- Wrapper script criado para funcionar sem dependência do make
- Mensagens melhoradas com instruções claras sobre formas de execução
- Conformidade com AGENTS.md (política de scripts, Makefile, Docker)

## Regras aplicadas
- Dockerfiles seguem padrão do projeto (apenas instalação e execução)
- Variáveis de ambiente com valores padrão no docker-compose.yml
- Scripts shell com shebang e cabeçalho de caminho
- Makefile com indentação TAB
- Serviço prettier usa profile `tools` (não inicia automaticamente)

## Validações
- [x] Estrutura `prettier/` criada com Dockerfile e entrypoint.sh
- [x] Serviço adicionado ao docker-compose.yml com configuração adequada
- [x] Script de instalação de hooks criado e executável
- [x] Makefile atualizado com novos targets
- [x] Cabeçalhos de caminho presentes em todos os arquivos
- [x] Conformidade com padrões do projeto

## Como usar
1. Instalar o hook usando uma das opções:
   - `./install-hooks.sh` (recomendado, funciona sem make)
   - `bash scripts/install-git-hooks.sh` (execução direta)
   - `make install-hooks` (se make estiver instalado)
2. O hook será executado automaticamente antes de cada push
3. Se arquivos forem formatados, o push será bloqueado e instruções serão exibidas
4. Para desabilitar temporariamente: `chmod -x .git/hooks/pre-push`
5. Para reabilitar: `chmod +x .git/hooks/pre-push`

## Observações técnicas
- Hook usa `set -u` ao invés de `set -e` para evitar falhas com códigos de saída do Prettier
- Hook verifica disponibilidade de Docker e Docker Compose antes de executar
- Hook salva estado do git antes da formatação e compara após para detectar mudanças
- Serviço prettier usa profile `tools` para não iniciar automaticamente com `docker compose up`
