# docker-compose-job.yml
# Servi√ßo de Worker Job (CSV Onboarding)

volumes:
  job-inbox:
  job-processed:
  job-failed:

services:
  monorepo-job:
    build:
      context: ./app/job
      dockerfile: Dockerfile
    image: "${APP_JOB_IMAGE_NAME:-job}"
    container_name: "${APP_JOB_CONTAINER_NAME:-job}"
    hostname: "${APP_JOB_HOSTNAME:-job}"
    environment:
      NODE_ENV: "${APP_JOB_NODE_ENV:-development}"
      PORT: "${APP_JOB_PORT:-3002}"
      APP_JOB_INBOX: "${APP_JOB_INBOX:-/var/data/inbox}"
      APP_JOB_PROCESSED: "${APP_JOB_PROCESSED:-/var/data/processed}"
      APP_JOB_FAILED: "${APP_JOB_FAILED:-/var/data/failed}"
      APP_API_BASE_URL: "${APP_API_BASE_URL:-http://localhost:3001}"
      APP_API_TOKEN: "${APP_JOB_SERVICE_TOKEN:-default-service-token}"
      APP_JOB_POLL_INTERVAL: "${APP_JOB_POLL_INTERVAL:-60000}"
      APP_JOB_BATCH_SIZE: "${APP_JOB_BATCH_SIZE:-100}"
      APP_JOB_MAX_RETRIES: "${APP_JOB_MAX_RETRIES:-3}"
      LOG_LEVEL: "${APP_JOB_LOG_LEVEL:-info}"
      APP_JOB_BASE_URL: "${APP_JOB_BASE_URL:-http://localhost:3002}"
    ports:
      - "${APP_JOB_PORT:-3002}:3002"
    volumes:
      - job-inbox:/var/data/inbox
      - job-processed:/var/data/processed
      - job-failed:/var/data/failed
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:3002/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
